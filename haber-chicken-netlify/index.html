<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haber Chicken - Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        .body-no-scroll {
            overflow: hidden;
        }
        .bg-haber-red { background-color: #d9232d; }
        .text-haber-red { color: #d9232d; }
        .border-haber-red { border-color: #d9232d; }
        .bg-haber-yellow { background-color: #fbbd08; }
        .text-haber-yellow { color: #fbbd08; }
        .border-haber-yellow { border-color: #fbbd08; }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 40;
        }
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
        .cart-item-enter {
            animation: slide-in 0.3s ease-out forwards;
        }
        @keyframes slide-in {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-3">
                <div id="logo-container" class="flex items-center space-x-3 cursor-pointer" title="Admin Login">
                     <div class="w-24 h-auto">
                        <img src="haberchickenlogo.jpg" alt="Haber Chicken Logo" class="w-full h-auto" onerror="this.style.display='none'">
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="cart-button" class="relative">
                        <i class="fas fa-shopping-cart text-3xl text-gray-700 hover:text-haber-red transition-colors"></i>
                        <span id="cart-count" class="absolute -top-2 -right-3 bg-haber-red text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center border-2 border-white">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <section id="special-offers-section" class="mb-12">
            <h2 class="text-3xl font-bold mb-6 text-haber-red border-b-4 border-haber-yellow pb-2">Special Offers</h2>
            <div id="special-offers-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>
        <section id="menu-section">
            <h2 class="text-3xl font-bold mb-6 text-gray-800 border-b-2 border-gray-300 pb-2">Our Menu</h2>
            <div id="menu-container" class="space-y-10"></div>
        </section>
    </main>

    <!-- Shopping Cart Sidebar -->
    <div id="cart-sidebar" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-40 flex flex-col">
        <div class="flex justify-between items-center p-4 border-b bg-gray-50">
            <h3 class="text-xl font-bold text-haber-red">Your Order</h3>
            <button id="close-cart-button" class="text-gray-600 hover:text-gray-900"><i class="fas fa-times text-2xl"></i></button>
        </div>
        <div id="cart-items" class="flex-grow p-4 overflow-y-auto">
             <p id="empty-cart-message" class="text-gray-500 text-center mt-8">Your cart is empty.</p>
        </div>
        <div class="p-4 border-t bg-gray-50">
            <div class="flex justify-between items-center font-bold text-lg mb-4">
                <span>Total:</span>
                <span id="cart-total">0 L.L.</span>
                <span>+ Delivery</span>
            </div>
            <button id="checkout-button" class="w-full bg-haber-red text-white py-3 rounded-lg font-bold hover:bg-red-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                <i class="fab fa-whatsapp"></i><span>Proceed to Checkout</span>
            </button>
        </div>
    </div>
    <div id="cart-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-60 z-30"></div>

    <!-- Modals -->
    <div id="modal-backdrop" class="modal-backdrop" style="display: none;"></div>

    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="modal w-full max-w-sm bg-white p-6 rounded-lg shadow-xl" style="display: none;">
        <h3 class="text-xl font-bold mb-4 text-center text-haber-red">Admin Access</h3>
        <input type="password" id="admin-password" placeholder="Enter password" class="w-full border border-gray-300 p-3 rounded-lg mb-4 text-center">
        <div class="flex justify-end space-x-2">
            <button id="cancel-login-button" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
            <button id="submit-login-button" class="px-4 py-2 bg-haber-red text-white rounded-lg hover:bg-red-700">Login</button>
        </div>
    </div>
    
    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal w-full max-w-md bg-white p-6 rounded-lg shadow-xl" style="display: none;">
        <h3 class="text-xl font-bold mb-4">Checkout Details</h3>
        <p class="text-sm text-gray-600 mb-4">Please provide your details. You will be redirected to WhatsApp to send the order.</p>
        <form id="checkout-form">
            <div class="space-y-4">
                <input type="text" id="customer-name" placeholder="Full Name" class="w-full border border-gray-300 p-2 rounded-lg" required>
                <input type="tel" id="customer-phone" placeholder="Phone Number (e.g., 70123456)" class="w-full border border-gray-300 p-2 rounded-lg" required>
                <input type="text" id="customer-location" placeholder="Location / Address" class="w-full border border-gray-300 p-2 rounded-lg" required>
            </div>
            <div class="flex justify-end space-x-2 mt-6">
                <button type="button" id="cancel-checkout-button" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                <button type="submit" id="confirm-order-button" class="px-4 py-2 bg-haber-red text-white rounded-lg hover:bg-red-700 flex items-center">
                    <span>Open WhatsApp</span>
                </button>
            </div>
        </form>
    </div>

    <!-- Custom Alert Modal -->
    <div id="alert-modal" class="modal w-full max-w-sm bg-white p-6 rounded-lg shadow-xl text-center" style="display: none;">
        <p id="alert-message" class="mb-4 text-lg"></p>
        <button id="alert-ok-button" class="px-6 py-2 bg-haber-red text-white rounded-lg hover:bg-red-700">OK</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async () => {
            
            const menuContainer = document.getElementById('menu-container');
            const specialOffersContainer = document.getElementById('special-offers-container');
            const cartButton = document.getElementById('cart-button');
            const cartSidebar = document.getElementById('cart-sidebar');
            const closeCartButton = document.getElementById('close-cart-button');
            const cartBackdrop = document.getElementById('cart-backdrop');
            const cartCount = document.getElementById('cart-count');
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalEl = document.getElementById('cart-total');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const checkoutButton = document.getElementById('checkout-button');
            
            const modalBackdrop = document.getElementById('modal-backdrop');
            const logoContainer = document.getElementById('logo-container');
            const adminLoginModal = document.getElementById('admin-login-modal');
            const cancelLoginButton = document.getElementById('cancel-login-button');
            const submitLoginButton = document.getElementById('submit-login-button');
            const adminPasswordInput = document.getElementById('admin-password');

            const checkoutModal = document.getElementById('checkout-modal');
            const cancelCheckoutButton = document.getElementById('cancel-checkout-button');
            const checkoutForm = document.getElementById('checkout-form');
            const customerNameInput = document.getElementById('customer-name');
            const customerPhoneInput = document.getElementById('customer-phone');
            const customerLocationInput = document.getElementById('customer-location');

            const alertModal = document.getElementById('alert-modal');
            const alertMessage = document.getElementById('alert-message');
            const alertOkButton = document.getElementById('alert-ok-button');

            const SHOP_WHATSAPP_NUMBER = '96181495030';
            const defaultMenuData = [
                { id: 1, name: 'Whole Grilled Chicken', price: 750000, category: 'Chicken Platters', description: 'Served with fries, garlic paste, and pickles.' },
                { id: 2, name: 'Half Grilled Chicken', price: 400000, category: 'Chicken Platters', description: 'Served with fries, garlic paste, and pickles.' },
                { id: 3, name: 'Chicken Shawarma Platter', price: 500000, category: 'Chicken Platters', description: 'Generous portion of chicken shawarma with sides.' },
                { id: 4, name: 'Chicken Sandwich', price: 250000, category: 'Sandwiches', description: 'Grilled chicken strips in fresh pita bread.' },
                { id: 5, name: 'Tawook Sandwich', price: 300000, category: 'Sandwiches', description: 'Marinated chicken breast cubes, grilled to perfection.' },
                { id: 6, name: 'French Fries', price: 150000, category: 'Sides', description: 'Crispy golden fries.' },
                { id: 7, name: 'Hummus', price: 180000, category: 'Sides', description: 'Creamy chickpea dip.' },
                { id: 8, name: 'Soft Drink', price: 75000, category: 'Beverages', description: 'Coke, Pepsi, 7up.' },
                { id: 9, name: 'Fresh Juice', price: 150000, category: 'Beverages', description: 'Orange or Carrot.' },
                { id: 10, name: 'Family Meal', price: 2500000, category: 'Family Meals', description: '2 whole chickens, large fries, large hummus, garlic, pickles & drinks.' },
                { id: 11, name: 'Double Chicken Burger', price: 450000, category: 'Sandwiches', description: 'Two grilled chicken patties with special sauce.' },
                { id: 12, name: 'Chicken Wings (6 pcs)', price: 350000, category: 'Sides', description: 'Spicy or BBQ chicken wings.' },
                { id: 13, name: 'Coleslaw Salad', price: 120000, category: 'Sides', description: 'Freshly made coleslaw.' },
                { id: 14, name: 'Garlic Bread (4 pcs)', price: 100000, category: 'Sides', description: 'Toasted bread with garlic butter.' },
                { id: 15, name: 'Water', price: 50000, category: 'Beverages', description: 'Small bottle of mineral water.' },
                { id: 16, name: 'Iced Tea', price: 90000, category: 'Beverages', description: 'Lemon or Peach flavor.' },
                { id: 17, name: 'Extra Garlic Sauce', price: 30000, category: 'Extras', description: 'An extra serving of our famous garlic sauce.' },
                { id: 18, name: 'Extra Pickles', price: 30000, category: 'Extras', description: 'An extra serving of mixed pickles.' },
                { id: 19, name: 'Spicy Grilled Chicken', price: 800000, category: 'Chicken Platters', description: 'Whole chicken with a spicy marinade.' },
                { id: 20, name: 'Tawook Platter', price: 600000, category: 'Chicken Platters', description: 'Skewers of marinated chicken breast with sides.' },
            ];

            let menuData = [];
            let specialOffers = [];
            let cart = [];
            let db, menuDocRef, offersDocRef;

            const formatCurrency = (price) => {
                if (typeof price !== 'number') price = 0;
                return `${price.toLocaleString('en-US')} L.L.`;
            };
            
            const loadDataFromFirestore = () => {
                onSnapshot(menuDocRef, (doc) => {
                    if (doc.exists()) {
                        menuData = doc.data().items;
                    } else {
                        setDoc(menuDocRef, { items: defaultMenuData });
                        menuData = defaultMenuData;
                    }
                    renderMenu();
                    renderSpecialOffers();
                    renderCart();
                });

                onSnapshot(offersDocRef, (doc) => {
                    if (doc.exists()) {
                        specialOffers = doc.data().items;
                    } else {
                        setDoc(offersDocRef, { items: [] });
                        specialOffers = [];
                    }
                    renderMenu();
                    renderSpecialOffers();
                    renderCart();
                });
            };

            const openModal = (modal) => {
                modalBackdrop.style.display = 'block';
                modal.style.display = 'block';
                document.body.classList.add('body-no-scroll');
            };
            
            const closeModal = (modal) => {
                modalBackdrop.style.display = 'none';
                modal.style.display = 'none';
                document.body.classList.remove('body-no-scroll');
            };

            const showAlert = (message) => {
                alertMessage.textContent = message;
                openModal(alertModal);
            }

            const renderMenu = () => {
                const categories = [...new Set(menuData.map(item => item.category))];
                menuContainer.innerHTML = categories.length > 0 ? categories.map(category => `
                    <div id="category-${category.replace(/\s+/g, '-')}">
                        <h3 class="text-2xl font-bold mb-4 text-gray-700">${category}</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${menuData.filter(item => item.category === category).map(item => `
                                <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:scale-105 transition-transform duration-300 flex flex-col">
                                    <div class="p-6 flex-grow">
                                        <h4 class="text-xl font-semibold mb-2">${item.name}</h4>
                                        <p class="text-gray-600 mb-4 text-sm">${item.description || ''}</p>
                                    </div>
                                    <div class="p-6 bg-gray-50 flex justify-between items-center">
                                        <span class="text-lg font-bold text-gray-800">${formatCurrency(item.price)}</span>
                                        <button data-id="${item.id}" class="add-to-cart-btn bg-haber-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors">Add</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('') : '<p class="text-center text-gray-500">The menu is currently empty. The owner is updating it!</p>';
            };

            const renderSpecialOffers = () => {
                if (specialOffers.length === 0) {
                    specialOffersContainer.innerHTML = '<p class="text-gray-500 md:col-span-2 lg:col-span-3">No special offers at the moment. Check back soon!</p>';
                    document.getElementById('special-offers-section').style.display = 'none';
                    return;
                }
                document.getElementById('special-offers-section').style.display = 'block';
                specialOffersContainer.innerHTML = specialOffers.map(offer => {
                    const originalItem = menuData.find(item => item.id === offer.id);
                    if (!originalItem) return '';
                    return `
                        <div class="bg-white border-2 border-haber-yellow rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition-transform duration-300 flex flex-col">
                            <div class="p-6 flex-grow">
                                <h4 class="text-xl font-bold text-haber-red mb-2">${originalItem.name}</h4>
                                <p class="text-gray-600 mb-4 text-sm">${originalItem.description || ''}</p>
                            </div>
                            <div class="p-6 bg-yellow-50 flex justify-between items-center">
                                <div>
                                    <span class="text-lg font-bold text-haber-red mr-2">${formatCurrency(offer.specialPrice)}</span>
                                    <span class="text-sm text-gray-500 line-through">${formatCurrency(originalItem.price)}</span>
                                </div>
                                <button data-id="${originalItem.id}" data-price="${offer.specialPrice}" class="add-to-cart-btn bg-haber-yellow text-gray-800 px-4 py-2 rounded-lg font-bold hover:bg-amber-400 transition-colors">Add</button>
                            </div>
                        </div>
                    `
                }).join('');
            };

            const renderCart = () => {
                cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
                checkoutButton.disabled = cart.length === 0;

                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '';
                    emptyCartMessage.style.display = 'block';
                } else {
                    emptyCartMessage.style.display = 'none';
                    cartItemsContainer.innerHTML = cart.map(cartItem => {
                        const menuItem = menuData.find(item => item.id === cartItem.id);
                        const offer = specialOffers.find(o => o.id === cartItem.id);
                        const price = offer ? offer.specialPrice : menuItem.price;
                        return `
                            <div class="flex items-center justify-between py-3 border-b cart-item-enter">
                                <div>
                                    <p class="font-semibold">${menuItem.name}</p>
                                    <p class="text-sm text-gray-500">${formatCurrency(price)}</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <button class="cart-quantity-btn p-1 rounded-full w-6 h-6 flex items-center justify-center bg-gray-200 hover:bg-gray-300" data-id="${cartItem.id}" data-change="-1">-</button>
                                    <span>${cartItem.quantity}</span>
                                    <button class="cart-quantity-btn p-1 rounded-full w-6 h-6 flex items-center justify-center bg-gray-200 hover:bg-gray-300" data-id="${cartItem.id}" data-change="1">+</button>
                                    <button class="remove-from-cart-btn text-red-500 hover:text-red-700" data-id="${cartItem.id}"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                const total = cart.reduce((sum, cartItem) => {
                    const menuItem = menuData.find(item => item.id === cartItem.id);
                    const offer = specialOffers.find(o => o.id === cartItem.id);
                    const price = offer ? offer.specialPrice : menuItem.price;
                    return sum + (price * cartItem.quantity);
                }, 0);
                cartTotalEl.textContent = formatCurrency(total);
            };

            const addToCart = (itemId) => {
                const existingItem = cart.find(item => item.id === itemId);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ id: itemId, quantity: 1 });
                }
                renderCart();
            };

            const updateCartQuantity = (itemId, change) => {
                const cartItem = cart.find(item => item.id === itemId);
                if (cartItem) {
                    cartItem.quantity += change;
                    if (cartItem.quantity <= 0) {
                        cart = cart.filter(item => item.id !== itemId);
                    }
                }
                renderCart();
            };

            const removeFromCart = (itemId) => {
                cart = cart.filter(item => item.id !== itemId);
                renderCart();
            };
            
            const handleCheckout = (e) => {
                e.preventDefault();
                const name = customerNameInput.value.trim();
                const phone = customerPhoneInput.value.trim();
                const location = customerLocationInput.value.trim();

                if (!name || !phone || !location) {
                    showAlert('Please fill in all your details.');
                    return;
                }

                let orderDetailsText = `*New Order from Haber Chicken Website*\n\n*Customer:* ${name}\n*Phone:* ${phone}\n*Location:* ${location}\n\n*Order Details:*\n`;
                let total = 0;
                cart.forEach(cartItem => {
                    const menuItem = menuData.find(item => item.id === cartItem.id);
                    const offer = specialOffers.find(o => o.id === cartItem.id);
                    const price = offer ? offer.specialPrice : menuItem.price;
                    total += price * cartItem.quantity;
                    orderDetailsText += `- ${cartItem.quantity}x ${menuItem.name} (${formatCurrency(price * cartItem.quantity)})\n`;
                });
                orderDetailsText += `\n*Total: ${formatCurrency(total)}* + Delivery Fee`;

                const encodedMessage = encodeURIComponent(orderDetailsText);
                const whatsappUrl = `https://wa.me/${SHOP_WHATSAPP_NUMBER}?text=${encodedMessage}`;
                window.open(whatsappUrl, '_blank');
                
                showAlert('You will be redirected to WhatsApp. Please press send to confirm your order!');
                cart = [];
                checkoutForm.reset();
                renderCart();
                closeModal(checkoutModal);
                if (cartSidebar.classList.contains('translate-x-0')) {
                    toggleCartSidebar();
                }
            };

            const toggleCartSidebar = () => {
                cartSidebar.classList.toggle('translate-x-full');
                cartBackdrop.classList.toggle('hidden');
            };

            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyAVI2Pr17IpIO89O_dQ6HIIZiEY_IicYhE",
                    authDomain: "haberchickenmenu.firebaseapp.com",
                    projectId: "haberchickenmenu",
                    storageBucket: "haberchickenmenu.firebasestorage.app",
                    messagingSenderId: "556537738142",
                    appId: "1:556537738142:web:786c5c0aadedc858aa1c8f",
                    measurementId: "G-4XGDLFV7XN"
                };

                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                db = getFirestore(app);

                await signInAnonymously(auth);
                
                onAuthStateChanged(auth, user => {
                    if (user) {
                        const appId = firebaseConfig.projectId;
                        menuDocRef = doc(db, "artifacts", appId, "public_data", "menu");
                        offersDocRef = doc(db, "artifacts", appId, "public_data", "offers");
                        loadDataFromFirestore();
                    }
                });
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                showAlert("Could not connect to the cloud database. Please check your Firebase setup (Anonymous Sign-in must be enabled). Displaying local data only.");
            }

            cartButton.addEventListener('click', toggleCartSidebar);
            closeCartButton.addEventListener('click', toggleCartSidebar);
            cartBackdrop.addEventListener('click', toggleCartSidebar);
            
            document.body.addEventListener('click', (e) => {
                const btn = e.target.closest('.add-to-cart-btn');
                if (btn) {
                    const id = parseInt(btn.dataset.id);
                    addToCart(id);
                    const originalText = btn.innerHTML;
                    btn.innerHTML = 'Added!';
                    btn.classList.add('bg-green-500');
                    setTimeout(() => {
                        btn.innerHTML = originalText;
                        btn.classList.remove('bg-green-500');
                    }, 1000);
                }
            });
            
            cartItemsContainer.addEventListener('click', (e) => {
                const quantityBtn = e.target.closest('.cart-quantity-btn');
                const removeBtn = e.target.closest('.remove-from-cart-btn');
                if (quantityBtn) {
                    const id = parseInt(quantityBtn.dataset.id);
                    const change = parseInt(quantityBtn.dataset.change);
                    updateCartQuantity(id, change);
                }
                if (removeBtn) {
                    const id = parseInt(removeBtn.dataset.id);
                    removeFromCart(id);
                }
            });
            
            logoContainer.addEventListener('click', () => openModal(adminLoginModal));
            cancelLoginButton.addEventListener('click', () => closeModal(adminLoginModal));
            submitLoginButton.addEventListener('click', () => {
                if (adminPasswordInput.value === 'eliasrabih123') {
                    // Set a flag in session storage and redirect to the new admin page
                    sessionStorage.setItem('isAdminLoggedIn', 'true');
                    window.location.href = 'admin.html';
                } else {
                    showAlert('Incorrect password.');
                    adminPasswordInput.value = '';
                }
            });
            
            checkoutButton.addEventListener('click', () => {
                if (cart.length > 0) {
                    openModal(checkoutModal);
                }
            });
            cancelCheckoutButton.addEventListener('click', () => closeModal(checkoutModal));
            checkoutForm.addEventListener('submit', handleCheckout);

            alertOkButton.addEventListener('click', () => closeModal(alertModal));
        });
    </script>
</body>
</html>

